import{w as L}from"./with-props-BqwZr1IK.js";import{r as o,j as e,a as R,b as O,L as z}from"./chunk-IR6S3I6Y-C6Zvu3tq.js";import{G as T,u as U}from"./UserContext-BcfRxPbJ.js";import{H as I,a as H,b as G,M as V}from"./constants-CigxhbVp.js";import{d as B}from"./debounce-CDx3-cb2.js";import{P as J}from"./PageTransition-1p6Ne89E.js";import"./proxy-7hmYPAw3.js";const Y=({onRegisterSuccess:b})=>{const[d,u]=o.useState({email:"",first_name:"",last_name:"",display_name:"",password:"",password2:""}),[m,h]=o.useState(""),[l,f]=o.useState(""),i=async t=>{t.preventDefault();try{const c=await fetch("/api/auth/volunteer/register/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}),g=await c.json();if(!c.ok)throw new Error(g.error||"Registration failed");b(g)}catch(c){h(c.message)}},p=async t=>{try{const c=await fetch("/api/auth/google/callback/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_token:t.credential,user_type:"volunteer"})}),g=await c.json();if(!c.ok)throw new Error("Google registration failed");b(g)}catch(c){h(c.message)}},y=t=>{const c=V,g=I,w=H,v=G;t.length<c?f("Password must be at least 8 characters."):g.test(t)?w.test(t)?v.test(t)?f("Password is strong."):f("Password must include an uppercase letter."):f("Password must include a special character."):f("Password must include a number.")};return e.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[m&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 text-red-700 rounded",children:m}),e.jsx(T,{onSuccess:p,onError:()=>h("Google registration failed"),className:"w-full mb-4",containerProps:{allow:"identity-credentials-get"},use_fedcm_for_prompt:!0}),e.jsxs("div",{className:"relative my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with email"})})]}),e.jsxs("form",{className:"space-y-6",onSubmit:i,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email address"}),e.jsx("input",{id:"email",type:"email",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>u({...d,email:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"first_name",className:"block text-sm font-medium text-gray-700",children:"First Name"}),e.jsx("input",{id:"first_name",type:"first_name",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>u({...d,first_name:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"last_name",className:"block text-sm font-medium text-gray-700",children:"Last Name"}),e.jsx("input",{id:"last_name",type:"last_name",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>u({...d,last_name:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"display_name",className:"block text-sm font-medium text-gray-700",children:"Display Name"}),e.jsx("input",{id:"display_name",type:"display_name",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>u({...d,display_name:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsx("input",{id:"password",type:"password",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>{const c=t.target.value;u({...d,password:c}),y(c)}})]}),e.jsx("p",{id:"message",className:"text-sm mt-1 text-red-600",children:l}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password2",className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),e.jsx("input",{id:"password2",type:"password",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>u({...d,password2:t.target.value})})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Sign up"})})]})]})},Q=({onRegisterSuccess:b})=>{const[d,u]=o.useState(1),[m,h]=o.useState({name:"",charity_number:"",description:"",logo:null,selected_charity_data:null,contact_info:null}),[l,f]=o.useState({email:"",username:"",password:"",password2:""}),[i,p]=o.useState({verified:!1,message:"",charityDomain:"",requiresManualApproval:!1,manualApprovalRequested:!1}),[y,t]=o.useState(""),[c,g]=o.useState(""),[w,v]=o.useState([]),[D,N]=o.useState(!1),[K,j]=o.useState(!1),_=o.useRef(null),k=R();o.useEffect(()=>{l.email&&i.charityDomain&&q()},[l.email,i.charityDomain]);const q=()=>{const s=l.email.split("@")[1],r=i.charityDomain;if(!s){p(n=>({...n,verified:!1,message:"Please enter a valid email address",requiresManualApproval:!1}));return}p(s===r?n=>({...n,verified:!0,message:`Email verified with domain ${r}`,requiresManualApproval:!1,manualApprovalRequested:!1}):n=>({...n,verified:!1,message:`Email domain doesn't match charity domain ${r||"unknown"}`,requiresManualApproval:!0}))};o.useEffect(()=>{const s=r=>{_.current&&!_.current.contains(r.target)&&j(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const S=o.useRef(B(async s=>{if(s.length<3){v([]),N(!1);return}N(!0);try{const a=(await(await fetch(`/api/charity-search/?q=${encodeURIComponent(s)}`)).json()).sort((x,C)=>x.reg_status==="RM"&&C.reg_status!=="RM"?1:x.reg_status!=="RM"&&C.reg_status==="RM"?-1:x.charity_name.localeCompare(C.charity_name));v(a),a&&a.length>0&&j(!0)}catch(r){console.error("Search failed:",r)}finally{N(!1)}},700)).current;o.useEffect(()=>()=>{S.cancel()},[S]);const E=s=>{const r=s.target.value;g(r),r.length<3?(v([]),j(!1)):(N(!0),S(r))},A=async(s,r=0)=>{try{const a=await(await fetch(`/api/charity-details/${s}/${r}`)).json();a.activities&&h(x=>({...x,description:a.activities})),await P(s,r)}catch(n){console.error("Failed to fetch charity details:",n)}},P=async(s,r=0)=>{try{const a=await(await fetch(`/api/charity-contact-information/${s}/${r}`)).json();h(x=>({...x,contact_info:a})),a.web&&p(x=>({...x,charityDomain:a.web}))}catch(n){console.error("Failed to fetch charity contact info:",n)}},F=s=>{h(r=>({...r,name:s.charity_name,charity_number:s.reg_charity_number,selected_charity_data:s})),g(s.charity_name),v([]),j(!1),s.reg_charity_number&&A(s.reg_charity_number,s.group_subsid_suffix||0)},M=async s=>{s.preventDefault();const r=new FormData,n={...m,...l,domain_verified:i.verified,manual_approval_requested:i.manualApprovalRequested};Object.keys(n).forEach(a=>{a==="selected_charity_data"&&n[a]||a==="contact_info"&&n[a]?r.append(a,JSON.stringify(n[a])):n[a]!==null&&r.append(a,n[a])});try{const a=await fetch("/api/auth/organization/register/",{method:"POST",body:r}),x=await a.json();if(!a.ok)throw new Error(x.error||"Registration failed");i.verified?k("/verify-organization",{state:{email:l.email}}):k("/login",{state:{message:"Your organization registration requires manual approval. You will receive an email when your account is approved."}})}catch(a){t(a.message)}},$=e.jsxs("div",{className:"relative",ref:_,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Search Registered Charity"}),e.jsx("input",{type:"text",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter charity name or number (min 3 characters)",value:c,onChange:E,onFocus:()=>{w.length>0&&j(!0)}}),D&&e.jsx("div",{className:"absolute right-3 top-9",children:e.jsxs("svg",{className:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),w.length>0&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto max-h-60",children:w.map(s=>e.jsxs("div",{className:"cursor-pointer hover:bg-gray-100 py-2 px-4",onClick:()=>F(s),children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.charity_name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Charity Number: ",s.reg_charity_number,s.reg_status==="RM"&&e.jsx("span",{className:"ml-2 text-red-500",children:"(Removed)"})]}),s.date_of_registration&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Registered: ",new Date(s.date_of_registration).toLocaleDateString()]})]},`${s.reg_charity_number}-${s.organisation_number}`))})]});return e.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[y&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 text-red-700 rounded",children:y}),e.jsx("div",{className:"mb-5",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex",children:[e.jsx("button",{onClick:()=>u(1),className:`${d===1?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm`,children:"Organization Details"}),e.jsx("button",{onClick:()=>u(2),className:`${d===2?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm`,children:"Admin User"})]})})}),e.jsx("form",{className:"space-y-6",onSubmit:M,children:d===1?e.jsxs(e.Fragment,{children:[$,e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{required:!0,rows:4,value:m.description,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:s=>h({...m,description:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Organization Logo"}),e.jsxs("div",{className:"mt-1 flex items-center",children:[e.jsxs("label",{className:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500",children:[e.jsxs("span",{className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("svg",{className:"-ml-1 mr-2 h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Choose File"]}),e.jsx("input",{type:"file",className:"sr-only",accept:"image/*",onChange:s=>h({...m,logo:s.target.files[0]})})]}),m.logo&&e.jsx("span",{className:"ml-3 text-sm text-gray-600",children:m.logo.name})]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:()=>u(2),className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Next"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email Address"}),e.jsx("input",{type:"email",required:!0,value:l.email,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:s=>f({...l,email:s.target.value})}),i.charityDomain&&l.email&&e.jsx("div",{className:`mt-1 text-sm ${i.verified?"text-green-600":"text-yellow-600"}`,children:i.message}),i.requiresManualApproval&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"manual-approval",name:"manual-approval",type:"checkbox",checked:i.manualApprovalRequested,onChange:s=>p({...i,manualApprovalRequested:s.target.checked}),className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded"})}),e.jsxs("div",{className:"ml-3 text-sm",children:[e.jsx("label",{htmlFor:"manual-approval",className:"font-medium text-gray-700",children:"Request Manual Approval"}),e.jsx("p",{className:"text-gray-500",children:"Your email doesn't match the charity's domain. Check this box to request manual verification. Note: No verification email will be sent and admin approval will be required."})]})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Username"}),e.jsx("input",{type:"text",required:!0,value:l.username,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:s=>f({...l,username:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsx("input",{type:"password",required:!0,value:l.password,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:s=>f({...l,password:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),e.jsx("input",{type:"password",required:!0,value:l.password2,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:s=>f({...l,password2:s.target.value})})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{type:"button",onClick:()=>u(1),className:"w-1/2 py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Back"}),e.jsx("button",{type:"submit",disabled:!i.verified&&!i.manualApprovalRequested,className:`w-1/2 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white ${!i.verified&&!i.manualApprovalRequested?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}`,children:"Register"})]})]})})]})},W=()=>{const b=O(),d=R(),{login:u}=U(),[m,h]=o.useState("volunteer"),[l,f]=o.useState({}),[i,p]=o.useState("");o.useEffect(()=>{var t;(t=b.state)!=null&&t.type&&h(b.state.type)},[b]);const y=t=>{localStorage.setItem("access_token",t.access),localStorage.setItem("refresh_token",t.refresh),u(t.user),t.user.is_volunteer?d("/browse"):d("/dashboard")};return e.jsx(J,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Create your account"}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsxs("div",{className:"inline-flex rounded-md",role:"group",children:[e.jsx("button",{onClick:()=>h("volunteer"),className:`px-4 py-2 text-sm font-medium rounded-l-md ${m==="volunteer"?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:"Volunteer"}),e.jsx("button",{onClick:()=>h("organization"),className:`px-4 py-2 text-sm font-medium rounded-r-md ${m==="organization"?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:"Organization"})]})})]}),e.jsxs("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:[m==="volunteer"?e.jsx(Y,{onRegisterSuccess:y}):e.jsx(Q,{onRegisterSuccess:y}),e.jsxs("p",{className:"mt-6 text-center text-sm text-gray-600",children:["Already have an account?"," ",e.jsx(z,{to:"/login",className:"font-medium text-blue-600 hover:text-blue-500",children:"Sign in"})]})]})]})})},oe=L(W);export{oe as default};
