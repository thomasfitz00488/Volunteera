import{w as C}from"./with-props-BqwZr1IK.js";import{u as S,r,j as e,L as k}from"./chunk-IR6S3I6Y-C6Zvu3tq.js";import{P as v}from"./PageTransition-1p6Ne89E.js";import{u as E}from"./UserContext-BcfRxPbJ.js";import{a as y}from"./api-BXsSQKvn.js";import{S as M}from"./LoadingSpinner-CGbvDqwE.js";import{f as D}from"./format-CBpsKyOP.js";import"./proxy-7hmYPAw3.js";const $=({discussion:s,user:a,reload:o})=>{const[t,p]=r.useState(!1),[c,d]=r.useState(!1),[n,l]=r.useState({id:s.id,answer:""}),[m,u]=r.useState(""),j=i=>{const{name:x,value:h}=i.target;l(w=>({...w,[x]:h}))},b=async i=>{var x,h,w,N;i.preventDefault();try{o(g=>!g),await y.post(`/opportunities/${s.id}/discussions/`,n),d(!1),o(!1)}catch(g){console.error("Error response:",(x=g.response)==null?void 0:x.data),((h=g.response)==null?void 0:h.status)===403?u("You must be logged in as an organization to answer discussions"):u(((N=(w=g.response)==null?void 0:w.data)==null?void 0:N.error)||"Failed to answer discussion")}};async function f(){try{o(i=>!i),await y.delete(`/opportunities/${s.id}/discussions/`,n),d(!1),o(!1)}catch(i){console.error("Error response:",i)}}return e.jsx(v,{children:e.jsxs("div",{onClick:()=>p(!t),className:"bg-white p-6 rounded-lg shadow-md border border-gray-200 hover:bg-gray-100 hover:cursor-pointer",children:[e.jsxs("div",{className:"flex ",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.title}),e.jsxs("h4",{className:"ml-auto",children:[" ",D(new Date(s.time_created),"MMMM dd, yyyy, h:mm")," "]})]}),e.jsx("div",{className:"flex",children:e.jsx("h2",{children:s.answer&&!t?"1 Response":s.answer?null:"0 Responses"})}),t&&c==!1&&!s.answer?e.jsxs("div",{className:"flex",children:[e.jsxs("h3",{children:[" ",s.content," "]}),s.volunteer_email==a.email?e.jsx("button",{onClick:()=>f(),className:"ml-auto px-4 bg-red-500 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-red-50",children:"Delete"}):a.is_organization?e.jsx("button",{onClick:()=>d(!0),className:"ml-auto px-4 bg-green-500 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-red-50",children:"Answer"}):null]}):t&&s.answer?e.jsxs("h3",{children:[" Response: ",s.answer," "]}):null,c?e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Answer"}),e.jsx("textarea",{name:"answer",value:n.answer,onChange:j,required:!0,rows:"4",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700",children:"Answer Discussion"})]}):null]})})},A=({opportunity:s,onClose:a,id:o})=>{const[t,p]=r.useState({opportunity:s.id,title:"",content:""}),c=n=>{const{name:l,value:m}=n.target;p(u=>({...u,[l]:m}))},d=async n=>{var l;n.preventDefault();try{await y.post(`/opportunities/${o}/`,t),a()}catch(m){console.error("Error response:",(l=m.response)==null?void 0:l.data)}};return e.jsx("div",{className:"fixed top-0 left-0 w-full h-full backdrop-blur-sm bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-5xl w-full",children:e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Title"}),e.jsx("input",{type:"text",name:"title",onChange:c,required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Content"}),e.jsx("textarea",{type:"text",name:"content",onChange:c,required:!0,rows:10,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Close"}),e.jsx("div",{className:"flex ml-auto space-x-4",children:e.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700",children:"Save Changes"})})]})]})})})},_=()=>{const{id:s}=S(),[a,o]=r.useState(!1),[t,p]=r.useState(null),[c,d]=r.useState(null),[n,l]=r.useState(!0),[m,u]=r.useState(!1),{user:j}=E();return r.useEffect(()=>{(async()=>{try{l(!0);const f=await y.get(`/opportunities/${s}/`,{withCredentials:!0}),i=await y.get(`/opportunities/${s}/discussions`,{withCredentials:!0});p(f),d(i.sort((x,h)=>new Date(h.time_created)-new Date(x.time_created))),l(!1)}catch(f){console.error("Error fetching opportunity:",f)}})()},[s,a,m]),t?e.jsx(v,{children:n?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(M,{})}):e.jsx("div",{className:"min-h-screen bg-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsxs("nav",{className:"flex",children:[e.jsxs(k,{to:`/opportunity/${s}`,className:"text-sm text-gray-500 hover:text-gray-900",children:["â† Back to ",t.title]}),e.jsxs("div",{className:"lg:ml-auto",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"Application closing date"}),e.jsx("p",{className:"text-gray-600",children:D(new Date(t.end_date),"EEEE, MMMM dd, yyyy")}),e.jsx("button",{type:"button",onClick:()=>o(!0),className:"px-4 py-2 ml-auto border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700",children:a?"Close Discussion":"Create Discussion"})]})]}),e.jsx("div",{className:"flex flex-col lg:flex-row gap-12",children:e.jsx("div",{className:"lg:w-2/3",children:e.jsx("div",{className:"space-y-8",children:e.jsx("div",{children:e.jsx("h1",{className:"text-3xl mb-3 font-semibold text-gray-900",children:"Discussions"})})})})}),a&&e.jsx(A,{className:"w-full",opportunity:t,id:s,onClose:()=>o(!1)}),c.length==0?e.jsx("h3",{children:" No discussions yet, start one by clciking the button in the top right! "}):c.map(b=>e.jsx($,{discussion:b,user:j,reload:u},b.id))]})})}):null},I=C(_);export{I as default};
